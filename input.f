VARIABLE CURRENT_VALUE
VARIABLE SIZE 
8 CONSTANT SIZE_REQUESTED

: SETUP
	SETUP_9
	SETUP_10
	SETUP_BSC
	FALLING_EDGE_DETECT_SET 
	0 CURRENT_VALUE !				
	0 SIZE ! ;	
	

: CLEAR_PIN
	600 GPEDS0 ! ; 					\ We don't need to use a mask hence increase efficiency
	
: KEYS_MASK
	GPEDS0 10 1 MASK_REGISTER GPEDS0 9 1 MASK_REGISTER OR ;	
	
: PEEK_KEYPRESS							
	KEYS_MASK 
	GPEDS0 @ AND 
	DUP 0 <>
	IF
		1 MILLISECONDS DELAY		\ Makes sure the button has properly been
		GPLEV0 @ INVERT AND 		\ released, else a keypress could be read twice 
	THEN ;
	
	
: IS_PRESSED
	BEGIN						\ UPDATE : it should only check the approrpiate bits
		PEEK_KEYPRESS
	UNTIL ;

: READ_PIN						( -- 0/1 )	
	IS_PRESSED
	GPEDS0 @ 400 =					\ It leaves on the stack either 0 or 1
	IF
	0 
	ELSE
	GPEDS0 @ 200 =
	IF
	1
	THEN 
	THEN ; 
	
: LCD_HANDLE
	CURRENT_VALUE @ 10 =
	IF
	CLEAR_DISPLAY
	ELSE
	CURRENT_VALUE @ 11 =
	IF
	DISPLAY_LSHIFT
	ELSE
	CURRENT_VALUE @ 12 =
	IF
	DISPLAY_RSHIFT
	ELSE
	CURRENT_VALUE @ SEND_CHAR
	THEN
	THEN
	THEN ;
	
: WELCOME
	57 SEND_CHAR
	45 SEND_CHAR
	4C SEND_CHAR
	43 SEND_CHAR
	4F SEND_CHAR
	4D SEND_CHAR
	45 SEND_CHAR 
	21 SEND_CHAR
	3D0900 WAIT
	CLEAR_DISPLAY ;
	
	
	
: INPUT
	BEGIN 
		READ_PIN SIZE @ LSHIFT
		CURRENT_VALUE @ + CURRENT_VALUE !
		SIZE @ 1 + DUP SIZE !
		CLEAR_PIN
		SIZE_REQUESTED MOD 0 =
		IF
			LCD_HANDLE
			0 CURRENT_VALUE !
			0 SIZE ! 
		THEN
	AGAIN ;
	
: START
	SETUP
	LCD_INIT
	WELCOME
	INPUT ;

\ START










				

